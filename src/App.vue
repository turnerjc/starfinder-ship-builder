<script src="./app.js"></script>
<template>
  <!--
  | - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
  | APP
  | - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
  -->
  <div id="app" class="wrapper">
    <!-- Graphics -->
    <Graphics></Graphics>

    <!--
    | - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
    | SIDEBAR
    | - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
    -->

    <div class="sidebar" id="sidebar">
      <a href="#" class="sidebar__control sidebar__close">
        <svg class="icon">
          <use xlink:href="#icon-close" />
        </svg>
      </a>
      <h3>{{ shipName }} (Tier&nbsp;{{ tier.name }})</h3>

      <!-- Nav -->
      <Nav :params="params" :frame="frame"></Nav>

      <!-- Summary -->
      <Summary
        :totalBpCost="totalBpCost"
        :bpBudget="tier.bpBudget"
        :totalPcuCost="totalPcuCost"
        :pcuBudget="pcuBudget"></Summary>
    </div>
    <!-- sidebar -->

    <!--
    | - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
    | MAIN
    | - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
    -->

    <div class="main">
      <header class="app-header">
        <h1 id="title">Starforger RPG Ship Builder</h1>

        <div class="app-header__logo">
          <img src="./img/starfinder-logo-xs.png" width="150" height="auto" alt="Starfinder Logo" />
        </div>
      </header>

      <div>
        <p>
          Thanks to James Turner
          <a href="https://twitter.com/james_c_turner">(@james_c_turner)</a> for creating the
          original
          <a href="http://jamesturneronline.net/starfinder-ship-builder/"
            >Starfinder RPG Ship Builder</a
          >
        </p>
      </div>

      <!-- Intro -->
      <Intro />

      <!--
      <Patreon />
      -->

      <!--
      <Readout />
      | - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      |  READOUT
      | - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      -->

      <div class="box">
        <header class="box__header">
          <h2 id="readout">Ship Readout</h2>
        </header>
        <div class="box__info box__info--output">
          <div id="outputText">
            <h3>{{ shipName }} (Tier {{ tier.name }})</h3>
            <p>{{ frame.size }} {{ frameName }}</p>
            <p>
              <strong>Speed</strong> {{ thrusters.speed + thrustersBooster.speed
              }}<span v-if="params.sourcesInUse.som && params.thrustersMaterialId != 'none'">
                ({{ params.thrustersMaterialId }} thrusters)</span
              >; <strong>Maneuverability</strong> {{ frame.maneuverability }} (turn {{ turn }})<span
                v-if="driftEngine.engineRating == 'Special' || driftEngine.engineRating > 0"
                >; <strong>Hyperdrive</strong> {{ driftEngine.engineRating }}</span
              >
            </p>
            <p><strong>AC</strong> {{ armorClass }}; <strong>TL</strong> {{ targetLock }}</p>
            <p>
              <strong>HP</strong> {{ hp }}; <strong>DT</strong> {{ damageThreshold }};
              <strong>CT</strong> {{ criticalThreshold }}
            </p>
            <p v-if="ablativeArmor.id != 'none'">
              <strong>Ablative Armor</strong> {{ ablativeArmor.name }} (forward
              {{ params.ablativeArmorByPosition.forward }}, port
              {{ params.ablativeArmorByPosition.port }}, starboard
              {{ params.ablativeArmorByPosition.starboard }}, aft
              {{ params.ablativeArmorByPosition.aft }})
            </p>
            <!-- shields -->
            <p v-if="params.shieldType == 'shields'">
              <strong>Shields</strong> {{ shields.name }} (forward
              {{ params.shieldsByPosition.forward }}, port {{ params.shieldsByPosition.port }},
              starboard {{ params.shieldsByPosition.starboard }}, aft
              {{ params.shieldsByPosition.aft }})
            </p>
            <!-- deflector shields -->
            <p v-else>
              <strong>Deflector Shield</strong> {{ deflectorShield.name }}; <strong>DV</strong>
              {{ deflectorShield.defenseValue }}/&ndash;
            </p>
            <!-- reinforced bulkheads -->
            <p v-if="params.sourcesInUse.som && params.reinforcedBulkheadId != 'none'">
              <strong>Reinforced Bulkheads</strong> {{ reinforcedBulkhead.name }};
              <strong>Fortification</strong> {{ reinforcedBulkhead.fortification }}
            </p>
            <!-- weapons -->
            <p v-for="(weaponDescription, position) in weaponDescriptions">
              <strong>Attack ({{ position.toTitleCase() }})</strong>
              {{ weaponDescription }}
            </p>
            <p>
              <strong>Power Core(s)</strong> {{ powerCoreDescription }};
              <strong>Hyperdrive</strong> {{ driftEngine.name }}; <strong>Systems </strong>
              <span v-html="systemsDescription"></span
              ><span v-if="hasSecurity">; <strong>Security</strong> {{ securityDescription }}</span
              ><span v-if="expansionBaysDescription != 'None'"
                >; <strong>Expansion Bays</strong> {{ expansionBaysDescription }}</span
              ><span v-if="params.fortifiedHullId != 'none'"
                >; <strong>Fortified Hull</strong> {{ fortifiedHull.name }}</span
              >
            </p>
            <p>
              <strong>Modifiers</strong> {{ modifiersDescription
              }}<span v-if="params.hasCrew">; <strong>Complement</strong> {{ complement }}</span>
            </p>
            <p v-if="params.customComponents.length > 0">
              <strong>Custom Components</strong> {{ customComponentsDescription }}
            </p>
            <p>
              <strong>Build Points</strong> cost {{ totalBpCost }}, max {{ tier.bpBudget }}
              <strong>Power Core Units</strong> non-essential
              {{ totalPcuCost.essential + totalPcuCost.nonEssential }}, essential
              {{ totalPcuCost.essential }}, max {{ pcuBudget }}
            </p>

            <div v-if="params.hasCrew">
              <h3>Crew</h3>
              <p v-for="roleId in selectOptionsCrew">
                <strong>{{ roleDescription[roleId] }}</strong> {{ crewDescriptions[roleId] }}
              </p>
              <p v-if="params.viId != 'none'"><strong>VI</strong> {{ viCrewDescription }}</p>
            </div>

            <h3>Concept</h3>
            <p v-html="params.shipConcept"></p>
          </div>
          <!-- #readout -->
        </div>
      </div>

      <!-- Sources -->
      <Sources
        :sources="sources"
        :params="params"
        @updateCrew="setDefaultCrewSkillValues"></Sources>

      <!--
      | - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      | SAMPLE SHIPS
      | - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      <SampleShips />
      -->
      <div class="box">
        <header class="box__header">
          <h2 id="sampleships">Sample Ships</h2>
        </header>

        <div class="box__select">
          <div class="form-group">
            <label for="sampleShipSelect">Select a sample ship</label>

            <!-- sort by -->
            <div class="form-inline" style="margin: 0.5rem 0">
              <div class="form-group">
                Sort by:
                <div class="radio">
                  <label style="display: inline-block; margin-right: 1rem">
                    <input
                      type="radio"
                      name="selectSampleShipSortOrder"
                      value="name"
                      v-model="selectSampleShipSortOrder" />
                    Name
                  </label>
                </div>
                <div class="radio">
                  <label style="display: inline-block; margin-right: 1rem">
                    <input
                      type="radio"
                      name="selectSampleShipSortOrder"
                      value="size"
                      v-model="selectSampleShipSortOrder" />
                    Size
                  </label>
                </div>
                <div class="radio">
                  <label style="display: inline-block; margin-right: 1rem">
                    <input
                      type="radio"
                      name="selectSampleShipSortOrder"
                      value="tier"
                      v-model="selectSampleShipSortOrder" />
                    Tier
                  </label>
                </div>
              </div>
            </div>
          </div>

          <div>
            <select class="form-control" id="sampleShipSelect" @change="inputSampleShipParams">
              <option value="none">None</option>
              <option v-for="option in selectOptionsSampleShip" :value="option.id">
                {{ getSampleShipOptionName(option) }}
              </option>
            </select>
          </div>
          <!-- #sampleships -->
        </div>
      </div>
      <!--
      | - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      | LOAD/SAVE
      | - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      <LoadSave/>
      -->
      <div class="box">
        <header class="box__header">
          <h2 id="loadsave">Load/Save</h2>
        </header>

        <div class="form-horizontal form-group">
          <button class="btn btn-lg btn-primary btn-gap" @click="filePick">Load Ship</button>
          <input
            type="file"
            id="fileInput"
            style="display: none"
            ref="fileInput"
            accept="application/json"
            @change="fileLoad" />
          <button class="btn btn-lg btn-primary btn-gap" @click="fileSave">Save Ship</button>
          <button class="btn btn-lg btn-primary" @click="clearAll">Clear All</button>
        </div>
      </div>

      <!--
      | - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      | CONCEPT
      | - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      <Concept />
      -->

      <div class="box">
        <header class="box__header">
          <h2 id="concept">Step 0: Concept</h2>
        </header>
        <div class="box__select">
          <div class="form-group">
            <label for="shipName">Ship Name or Class</label>
            <input
              type="text"
              id="shipName"
              v-model="params.shipName"
              class="form-control input-lg" />
          </div>
          <div class="form-group">
            <label for="shipConcept">Concept</label>
            <textarea
              id="shipConcept"
              cols="30"
              rows="3"
              v-model="params.shipConcept"
              class="form-control"></textarea>
          </div>
          <div class="checkbox">
            <label>
              <input type="checkbox" id="isUseStrictRules" v-model="params.isUseStrictRules" />
              Use strict ship building rules from <em>Starfinder Core Rules</em>?
            </label>
          </div>
        </div>
      </div>
      <!--
      <Tier />
      | - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      |  TIER
      | - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      -->
      <div class="box">
        <header class="box__header">
          <h2 id="tier">Step 1: Tier</h2>
        </header>
        <div class="box__select">
          <div class="form-group">
            <label for="tierSelect">Tier</label>
            <select
              class="form-control"
              id="tierSelect"
              v-model="params.tierId"
              @change="setDefaultCrewSkillValues">
              <option v-for="option in selectOptions.tier" :value="option.id">
                {{ option.name }}
              </option>
            </select>
          </div>
          <div class="checkbox">
            <label>
              <input
                type="checkbox"
                id="isSetDefaultCrewSkillValues"
                v-model="params.isSetDefaultCrewSkillValues" />
              Automatically update crew skill ranks when levelling up?
            </label>
          </div>
        </div>
        <div class="box__info">
          <strong>Build Point Budget</strong>: {{ tier.bpBudget }}; <strong>HP Increase</strong>:
          {{ tier.hpIncrease }}
        </div>
      </div>
      <!--
      <ShipFrame />
      | - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      |  FRAME
      | - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      -->

      <div class="box">
        <header class="box__header">
          <h2 id="frame">Step 2: Frame</h2>
        </header>
        <div class="box__select">
          <div class="form-group">
            <label for="frameSelect">Frame</label>
            <select
              name="frame"
              id="frameSelect"
              class="form-control"
              v-model="params.frameId"
              @change="updateFrame">
              <option v-for="option in selectOptions.frame" :value="option.id">
                {{ option.name }}
              </option>
            </select>
          </div>
        </div>
        <div class="box__info">
          <strong>Size</strong> {{ frame.size }}; <strong>Maneuverability</strong>
          {{ frame.maneuverability }}; <strong>HP</strong> {{ hp }}; <strong>DT</strong>
          {{ frame.dt }}; <strong>CT</strong> {{ criticalThreshold }};
          <strong>Expansion Bays</strong> {{ frame.expansionBays }}; <strong>Minimum Crew</strong>
          {{ frame.minCrew }}; <strong>Maximum Crew</strong> {{ frame.maxCrew }}
        </div>
        <div class="box__cost">
          <svg class="icon">
            <use xlink:href="#icon-build" />
          </svg>
          {{ frame.bpCost }}
        </div>
      </div>
      <!--
      <CustomFrame />
      | - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      |  CUSTOM FRAME
      | - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      -->

      <div class="box" v-if="this.params.frameId == 'custom'">
        <header class="box__header">
          <h2 id="frame">Custom Frame</h2>
        </header>

        <div class="box--flex box--flex--bottom">
          <!-- Base frame -->
          <div class="col-sm-1-1">
            <div class="box__select box--flex box--flex--bottom">
              <div class="col-sm-2-3">
                <div class="form-group">
                  <label for="customFrameBase">Use this frame as a base:</label>
                  <select
                    name="customFrameBase"
                    id="customFrameBase"
                    class="form-control"
                    v-model="params.customFrameBaseId">
                    <option v-for="option in selectOptionsBaseFrame" :value="option.id">
                      {{ option.name }}
                    </option>
                  </select>
                </div>
              </div>

              <div class="col-sm-1-3">
                <div class="form-group">
                  <button class="btn btn-primary" @click="resetCustomFrame">
                    Apply to Custom Frame
                  </button>
                </div>
              </div>
            </div>
          </div>

          <!-- Name -->
          <div class="box__select col-sm-1-2 col-lg-1-2">
            <div class="form-group">
              <label for="customFrameName">Name</label>
              <input
                name="customFrameName"
                id="customFrameName"
                class="form-control"
                v-model="params.customFrame.name" />
            </div>
          </div>

          <!-- Size -->
          <div class="box__select col-sm-1-2 col-lg-1-4">
            <div class="form-group">
              <label for="customFrameSize">Size</label>
              <select
                name="customFrameSize"
                id="customFrameSize"
                class="form-control"
                v-model="params.customFrame.size">
                <option v-for="option in selectOptions.sizeCategory" :value="option.id">
                  {{ option.id }}
                </option>
              </select>
            </div>
          </div>

          <!-- Maneuverability -->
          <div class="box__select col-sm-1-2 col-lg-1-4">
            <div class="form-group">
              <label for="frameName">Maneuverability</label>
              <select
                name="customFrameManeuverability"
                id="customFrameManeuverability"
                class="form-control"
                v-model="params.customFrame.maneuverability">
                <option value="perfect">Perfect</option>
                <option value="good">Good</option>
                <option value="average">Average</option>
                <option value="poor">Poor</option>
                <option value="clumsy">Clumsy</option>
              </select>
            </div>
          </div>

          <!-- HP -->
          <div class="box__select col-sm-1-2 col-lg-1-4 col-align-bottom">
            <div class="form-group">
              <label for="customFrameHp">HP</label>
              <input
                name="customFrameHp"
                type="number"
                id="customFrameHp"
                class="form-control"
                v-model="params.customFrame.hp"
                @input="params.customFrame.ct = Math.floor(parseInt(params.customFrame.hp) / 5)" />
            </div>
          </div>

          <!-- HP Increment -->
          <div class="box__select col-sm-1-2 col-lg-1-4 col-align-bottom">
            <div class="form-group">
              <label for="customFrameHpIncrement">HP Increment</label>
              <input
                name="customFrameHpIncrement"
                type="number"
                id="customFrameHpIncrement"
                class="form-control"
                v-model="params.customFrame.hpIncrement" />
            </div>
          </div>

          <!-- Damage Threshold -->
          <div class="box__select col-sm-1-2 col-lg-1-4 col-align-bottom">
            <div class="form-group">
              <label for="customFrameDt"
                >Damage Threshold<br /><small>(&ldquo;n/a&rdquo; or number)</small></label
              >
              <input
                name="customFrameDt"
                id="customFrameDt"
                class="form-control"
                v-model="params.customFrame.dt" />
            </div>
          </div>

          <!-- Crit. Threshold -->
          <div class="box__select col-sm-1-2 col-lg-1-4 col-align-bottom">
            <div class="form-group">
              <label for="customFrameCt">Crit. Threshold</label>
              <input
                name="customFrameCt"
                type="number"
                id="customFrameCt"
                class="form-control"
                v-model="params.customFrame.ct" />
            </div>
          </div>

          <!-- Weapon Mounts -->
          <div class="box__select col-sm-1-1">
            <p>Weapon Mounts</p>

            <div class="box--flex">
              <div
                v-for="position in ['forward', 'port', 'starboard', 'aft', 'turret']"
                class="col-sm-1-3 col-lg-1-5">
                <div class="custom-weapon-mount-position">
                  <span>{{ position.toTitleCase() }}</span>
                  <button @click="addCustomFrameMount(position)" class="btn btn-primary btn-sm">
                    <svg class="icon">
                      <use xlink:href="#icon-plus" />
                    </svg>
                  </button>
                </div>

                <div
                  v-for="(mount, mountIndex) in params.customFrame.mounts[position]"
                  class="form-group form-group--custom-frame-mount">
                  <select
                    :id="'customFrame' + position + 'Mount' + mountIndex"
                    class="form-control"
                    v-model="params.customFrame.mounts[position][mountIndex]"
                    @change="setWeaponMounts(frame.mounts)">
                    <option value="light">Light</option>
                    <option
                      v-if="['heavy', 'capital'].indexOf(customFrameSize.maxMountWeight) != -1"
                      value="heavy">
                      Heavy
                    </option>
                    <option
                      v-if="position != 'turret' && customFrameSize.maxMountWeight == 'capital'"
                      value="capital">
                      Capital
                    </option>
                  </select>
                  <button
                    class="btn btn-danger btn-sm"
                    @click="removeCustomFrameMount(position, mountIndex)">
                    <svg class="icon">
                      <use xlink:href="#icon-trash" />
                    </svg>
                  </button>
                </div>
              </div>
            </div>
          </div>

          <!-- Expansion Bays -->
          <div class="box__select col-sm-1-2 col-lg-1-4">
            <div class="form-group">
              <label for="customFrameExpansionBays">Expansion Bays</label>
              <input
                name="customFrameExpansionBays"
                type="number"
                id="customFrameExpansionBays"
                class="form-control"
                v-model="params.customFrame.expansionBays" />
            </div>
          </div>

          <!-- Min. Crew -->
          <div class="box__select col-sm-1-2 col-lg-1-4">
            <div class="form-group">
              <label for="customFrameMinCrew">Min. Crew</label>
              <input
                name="customFrameMinCrew"
                type="number"
                id="customFrameMinCrew"
                class="form-control"
                v-model="params.customFrame.minCrew" />
            </div>
          </div>

          <!-- Max. Crew -->
          <div class="box__select col-sm-1-2 col-lg-1-4">
            <div class="form-group">
              <label for="customFrameMaxCrew">Max. Crew</label>
              <input
                name="customFrameMaxCrew"
                type="number"
                id="customFrameMaxCrew"
                class="form-control"
                v-model="params.customFrame.maxCrew" />
            </div>
          </div>

          <!-- BP Cost -->
          <div class="box__select col-sm-1-2 col-lg-1-4">
            <div class="form-group">
              <label for="customFrameBpCost">BP Cost</label>
              <input
                name="customFrameBpCost"
                type="number"
                id="customFrameBpCost"
                class="form-control"
                v-model="params.customFrame.bpCost" />
            </div>
          </div>
        </div>

        <div class="box__cost">
          <svg class="icon">
            <use xlink:href="#icon-build" />
          </svg>
          {{ frame.bpCost }}
        </div>
      </div>
      <!--
      <Crew />
      | - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      |  CREW
      | - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      -->

      <div class="box">
        <header class="box__header">
          <h2 id="crew">Step 6: Crew</h2>
        </header>
        <div class="checkbox">
          <label>
            <input type="checkbox" id="hasCrew" v-model="params.hasCrew" />
            Include crew stats?
          </label>
        </div>
        <div class="checkbox" v-if="params.hasCrew">
          <label>
            <input
              type="checkbox"
              id="hasCrew"
              v-model="params.isSetDefaultCrewSkillValues"
              @change="setDefaultCrewSkillValues" />
            Set default crew skill values?
          </label>
        </div>
        <div class="box__select" v-if="params.hasCrew">
          <div class="cost__item">
            <span class="cost__name">Complement</span>
            <span class="cost__values">
              <span
                class="cost__current"
                v-bind:class="{ 'cost__current--danger': !isComplementValid }"
                >{{ complement }}</span
              >
              <span class="cost__budget"
                >({{ this.frame.minCrew }}&ndash;{{ this.frame.maxCrew }})</span
              >
            </span>
          </div>
        </div>
      </div>

      <template v-for="role in selectOptions.role">
        <div class="box crew" v-if="params.hasCrew">
          <h3 class="crew__header">{{ role.name }}</h3>

          <div class="checkbox">
            <label>
              <input type="checkbox" v-model="params.crewSkills[role.id].hasRole" />
              {{ role.hasRoleQuestion }}
            </label>
          </div>

          <div v-if="params.crewSkills[role.id].hasRole" class="crew__role">
            <!-- Officers -->
            <div
              class="crew__officers"
              v-if="params.crewSkills[role.id].countOfficers !== undefined">
              <div class="box--flex">
                <!-- number of officers -->
                <div
                  class="crew__officers__count form-group col-sm-1-2"
                  v-if="typeof params.crewSkills[role.id].countOfficers !== 'undefined'">
                  <label :for="role.id + '_countOfficers'">Number of officers</label>
                  <input
                    type="number"
                    :id="role.id + '_countOfficers'"
                    v-model="params.crewSkills[role.id].countOfficers"
                    class="form-control" />
                </div>

                <!-- officer team size -->
                <div
                  class="crew__officers__team-size form-group col-sm-1-2"
                  v-if="typeof params.crewSkills[role.id].countOfficerCrew !== 'undefined'">
                  <label :for="role.id + '_countOfficerCrew'">Size of crew in each team</label>
                  <input
                    type="number"
                    :id="role.id + '_countOfficerCrew'"
                    v-model="params.crewSkills[role.id].countOfficerCrew"
                    class="form-control" />
                </div>
              </div>
            </div>
            <!-- .crew__officers -->

            <!-- Skill -->
            <div v-for="skillId in role.skills" class="crew__skill">
              <!-- Skill name -->
              <h4 class="crew__skill__label">{{ getSkillName(skillId) }}</h4>

              <div class="box--flex">
                <!-- D&D skill -->
                <div v-if="params.sourcesInUse.dnd">
                  <!-- Skill proficiency -->
                  <div class="crew__skill__ranks checkbox col-sm-1-2">
                    <label>
                      <input
                        type="checkbox"
                        v-model="params.crewSkills[role.id].skills[skillId].hasProficiency" />{{
                        `Proficiency +${
                          params.crewSkills[role.id].skills[skillId].hasProficiency
                            ? skillProficiency
                            : 0
                        }`
                      }}
                    </label>
                  </div>
                  <!-- Skill expertise -->
                  <div class="crew__skill__ranks checkbox col-sm-1-2">
                    <label
                      v-if="
                        params.crewSkills[role.id].skills[skillId].hasProficiency &&
                        skillId != 'gunnery'
                      ">
                      <input
                        type="checkbox"
                        v-model="params.crewSkills[role.id].skills[skillId].hasExpertise" />{{
                        `Expertise +${
                          params.crewSkills[role.id].skills[skillId].hasExpertise
                            ? skillProficiency
                            : 0
                        }`
                      }}
                    </label>
                  </div>
                  <!-- Skill mod -->
                  <div class="crew__skill__mod form-group col-sm-1-2">
                    <label for="role.id + '_' + skillId + '_mod'">Mod</label>
                    <input
                      type="number"
                      class="form-control"
                      min="-1"
                      max="5"
                      :id="role.id + '_' + skillId + '_mod'"
                      v-model="params.crewSkills[role.id].skills[skillId].modifier" />
                  </div>
                </div>

                <!-- Starfinder skill -->
                <div v-else>
                  <!-- Skill ranks -->
                  <div
                    class="crew__skill__ranks form-group col-sm-1-2"
                    v-if="getItemById('skill', skillId).hasRanks">
                    <label for="role.id + '_' + skillId + '_ranks'">Ranks</label>
                    <input
                      type="number"
                      class="form-control"
                      :id="role.id + '_' + skillId + '_ranks'"
                      v-model="params.crewSkills[role.id].skills[skillId].ranks" />
                  </div>
                  <!-- Skill mod -->
                  <div class="crew__skill__mod form-group col-sm-1-2">
                    <label for="role.id + '_' + skillId + '_mod'">Mod</label>
                    <input
                      type="number"
                      class="form-control"
                      :id="role.id + '_' + skillId + '_mod'"
                      v-model="params.crewSkills[role.id].skills[skillId].modifier" />
                  </div>
                </div>
              </div>

              <!-- Skill ship mod -->
              <div class="crew__skill__ship">
                <strong>Ship mod </strong>
                <span v-if="skillId == 'computers'">{{
                  getPrefixedModifier(skillModifierComputers)
                }}</span>
                <span v-else-if="skillId == 'piloting'">{{
                  getPrefixedModifier(skillModifierPiloting)
                }}</span>
                <span v-else>&ndash;</span>
              </div>

              <!-- Skill total mod -->
              <div class="crew__skill__total">
                <strong>Total</strong>
                {{ getPrefixedModifier(skillTotals[role.id][skillId]) }}
              </div>
            </div>
            <!-- .crew__role__skills -->
          </div>
          <!-- .crew__role -->
        </div>
        <!-- .box -->
      </template>
      <!--
      <CrewQuarters />
      | - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      |  CREW QUARTERS
      | - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      -->

      <div class="box">
        <header class="box__header">
          <h3 id="crewQuarters">Crew Quarters</h3>
        </header>
        <div class="box__select">
          <div class="form-group">
            <label for="crewQuartersSelect">Crew Quarters</label>
            <select id="crewQuartersSelect" class="form-control" v-model="params.crewQuartersId">
              <option v-for="option in selectOptionsCrewQuarters" :value="option.id">
                {{ option.name }}
              </option>
            </select>
          </div>
        </div>
        <div class="box__cost">
          <svg class="icon">
            <use xlink:href="#icon-build" />
          </svg>
          {{ crewQuarters.bpCost }}
        </div>
      </div>

      <!--
      <PowerCore />
      | - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      |  POWER CORE
      | - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      -->

      <div class="box">
        <header class="box__header">
          <h2 id="powerCore">Step 3: Power Core</h2>
        </header>

        <div v-if="frame.size == 'Supercolossal'">
          <p class="text-warning">NOTE: Supercolossal ships can have either:</p>
          <ul>
            <li class="text-warning">
              One Supercolossal power core, and up to four Huge or Gargantuan cores, or
            </li>
            <li class="text-warning">Up to five Colossal power cores</li>
          </ul>
        </div>

        <div class="box__select">
          <div class="form-group" v-for="i in countPowerCoreHousings">
            <!-- power core -->
            <div class="form-group">
              <label :for="'powerCoreSelect_' + i">Power Core {{ i }}</label>
              <select
                :id="'powerCoreSelect_' + i"
                class="form-control"
                v-model="params.powerCoreIds[i - 1]"
                @change="maybeResetPowerCoreIds(i - 1)">
                <template v-for="option in getPowerCoreOptions(i - 1)">
                  <option :value="option.id" v-html="getPowerCoreOptionName(option)"></option>
                </template>
              </select>
            </div>

            <!-- special materials -->
            <div class="form" v-if="params.sourcesInUse.som">
              <div class="form-group">
                Special Material:
                <!-- none -->
                <div class="radio">
                  <label>
                    <input
                      type="radio"
                      :name="'selectPowerCoreSpecialMaterial' + i"
                      value="none"
                      v-model="params.powerCoreSpecialMaterials[i - 1]" />
                    None
                  </label>
                </div>
                <!-- abysium -->
                <div class="radio">
                  <label>
                    <input
                      type="radio"
                      :name="'selectPowerCoreSpecialMaterial' + i"
                      value="abysium"
                      v-model="params.powerCoreSpecialMaterials[i - 1]" />
                    Abysium (+25% PCU output; radiation hazard; +2 BP)
                  </label>
                </div>
                <!-- djezet -->
                <div class="radio">
                  <label>
                    <input
                      type="radio"
                      :name="'selectPowerCoreSpecialMaterial' + i"
                      value="djezet"
                      v-model="params.powerCoreSpecialMaterials[i - 1]" />
                    Djezet (+10% PCU output to expansion bays only; +1 BP)
                  </label>
                </div>
              </div>
            </div>
            <!-- special materials -->
          </div>
          <!-- v-for -->
        </div>
        <div class="box__info"><strong>PCU Budget</strong> {{ pcuBudget }}</div>
        <div class="box__cost">
          <svg class="icon">
            <use xlink:href="#icon-build" />
          </svg>
          {{ powerCoresBpCost }}
        </div>
      </div>
      <!--
      <Thrusters />
      | - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      |  THRUSTERS
      | - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      -->

      <div class="box">
        <header class="box__header">
          <h2 id="thrusters">Step 4: Thrusters</h2>
        </header>
        <div class="box__select">
          <div class="form-group">
            <label for="thrustersSelect">Thrusters</label>
            <select id="thrustersSelect" class="form-control" v-model="params.thrustersId">
              <template v-for="option in selectOptionsThruster">
                <option :value="option.id">{{ option.name }}</option>
              </template>
            </select>
          </div>

          <!-- special materials -->
          <div class="form" v-if="params.sourcesInUse.som">
            <div class="form-group">
              Special Material:
              <!-- none -->
              <div class="radio">
                <label>
                  <input
                    type="radio"
                    name="thrustersMaterialId"
                    value="none"
                    v-model="params.thrustersMaterialId" />
                  None
                </label>
              </div>
              <!-- horacalcum -->
              <div class="radio">
                <label>
                  <input
                    type="radio"
                    name="thrustersMaterialId"
                    value="horacalcum"
                    v-model="params.thrustersMaterialId" />
                  Horacalcum (+1 max speed; -1 Piloting check penalty based on max speed)
                </label>
              </div>
              <!-- inubrix -->
              <div class="radio">
                <label>
                  <input
                    type="radio"
                    name="thrustersMaterialId"
                    value="inubrix"
                    v-model="params.thrustersMaterialId" />
                  Inubrix (+1 to Piloting checks to avoid hazards)
                </label>
              </div>
            </div>
          </div>
          <!-- special materials -->
        </div>

        <!-- booster thrusters-->
        <div class="box__select" v-if="params.sourcesInUse.som && hasBoosterThrusterHousing">
          <div class="form-group">
            <label for="thrustersBoosterSelect">Thrusters Booster</label>
            <select
              id="thrustersBoosterSelect"
              class="form-control"
              v-model="params.thrustersBoosterId">
              <template v-for="option in selectOptionsThruster">
                <option :value="option.id">{{ option.name }}</option>
              </template>
            </select>
          </div>

          <!-- special materials -->
          <div class="form" v-if="params.sourcesInUse.som">
            <div class="form-group">
              Special Material:
              <!-- none -->
              <div class="radio">
                <label>
                  <input
                    type="radio"
                    name="thrustersBoosterMaterialId"
                    value="none"
                    v-model="params.thrustersBoosterMaterialId" />
                  None
                </label>
              </div>
              <!-- horacalcum -->
              <div class="radio">
                <label>
                  <input
                    type="radio"
                    name="thrustersBoosterMaterialId"
                    value="horacalcum"
                    v-model="params.thrustersBoosterMaterialId" />
                  Horacalcum (+1 max speed; -1 Piloting check penalty based on max speed)
                </label>
              </div>
              <!-- inubrix -->
              <div class="radio">
                <label>
                  <input
                    type="radio"
                    name="thrustersBoosterMaterialId"
                    value="inubrix"
                    v-model="params.thrustersBoosterMaterialId" />
                  Inubrix (+1 to Piloting checks to avoid hazards)
                </label>
              </div>
            </div>
          </div>
          <!-- special materials -->
        </div>
        <!-- thrusters booster -->

        <div class="box__info">
          <strong>Speed (in hexes)</strong> {{ thrusters.speed + thrustersBooster.speed }};
          <strong>Piloting Modifier</strong>
          {{ getPrefixedModifier(thrusters.pilotingModifier + thrustersBooster.pilotingModifier) }}
        </div>
        <div class="box__cost">
          <svg class="icon">
            <use xlink:href="#icon-power" />
          </svg>
          {{ thrusters.pcuCost + thrustersBooster.pcuCost }}
          <svg class="icon">
            <use xlink:href="#icon-build" />
          </svg>
          {{ thrusters.bpCost + thrustersBooster.bpCost }}
        </div>
      </div>
      <!-- Other Systems -->
      <h2 id="otherSystems">Step 5: Other Systems</h2>

      <!--
      <Armor />
      | - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      |  ARMOR
      | - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      -->

      <div class="box">
        <header class="box__header">
          <h3 id="armor">Armor</h3>
        </header>
        <div class="box__select">
          <div class="form-group">
            <label for="armorSelect">Armor</label>
            <select id="armorSelect" class="form-control" v-model="params.armorId">
              <option v-for="option in selectOptions.armor" :value="option.id">
                {{ option.name }}
              </option>
            </select>
          </div>

          <!-- special materials -->
          <div class="form" v-if="params.sourcesInUse.som">
            <div class="form-group">
              Special Material:
              <!-- none -->
              <div class="radio">
                <label>
                  <input
                    type="radio"
                    name="armorMaterialId"
                    value="none"
                    v-model="params.armorMaterialId" />
                  None
                </label>
              </div>
              <!-- adamantine-alloy -->
              <div class="radio">
                <label>
                  <input
                    type="radio"
                    name="armorMaterialId"
                    value="adamantine-alloy"
                    v-model="params.armorMaterialId" />
                  Adamantine Alloy (bonus to DT)
                </label>
              </div>
              <!-- noqual -->
              <div class="radio">
                <label>
                  <input
                    type="radio"
                    name="armorMaterialId"
                    value="noqual"
                    v-model="params.armorMaterialId" />
                  Noqual (bonus to magic officer&apos;s Mysticism DC and to AC and TL against
                  mystical weapons)
                </label>
              </div>
              <!-- siccatite -->
              <div class="radio">
                <label>
                  <input
                    type="radio"
                    name="armorMaterialId"
                    value="siccatite"
                    v-model="params.armorMaterialId" />
                  Siccatite (resist friction from atmosphere)
                </label>
              </div>
            </div>
          </div>
          <!-- special materials -->
        </div>

        <div class="box__info">
          <strong>Bonus to AC</strong> {{ getPrefixedModifier(armorBonus) }};
          <strong>Special</strong> {{ armorSpecial }}
        </div>
        <div class="box__cost">
          <svg class="icon">
            <use xlink:href="#icon-build" />
          </svg>
          {{ armorBpCost }}
        </div>
      </div>
      <!--
      <AblativeArmor />
      | - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      |  ABLATIVE ARMOR
      | - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      -->
      <div class="box" v-if="params.sourcesInUse.som == true">
        <header class="box__header">
          <h3 id="ablativeArmor">Ablative Armor</h3>
        </header>
        <div class="box__select">
          <div class="form-group">
            <label for="ablativeArmorSelect">Ablative Armor</label>
            <select
              id="ablativeArmorSelect"
              class="form-control"
              @change="setDefaultPositionDependentValues('ablativeArmor', 'tempHp')"
              v-model="params.ablativeArmorId">
              <option v-for="option in selectOptionsAblativeArmor" :value="option.id">
                {{ option.name }}
              </option>
            </select>
          </div>

          <h4>Temporary HP by position:</h4>
          <div class="box--flex">
            <div class="form-group col-sm-1-2 col-lg-1-4">
              <label for="">Forward</label>
              <input
                type="number"
                class="form-control"
                v-model="params.ablativeArmorByPosition.forward" />
            </div>
            <div class="form-group col-sm-1-2 col-lg-1-4">
              <label for="">Port</label>
              <input
                type="number"
                class="form-control"
                v-model="params.ablativeArmorByPosition.port" />
            </div>
            <div class="form-group col-sm-1-2 col-lg-1-4">
              <label for="">Starboard</label>
              <input
                type="number"
                class="form-control"
                v-model="params.ablativeArmorByPosition.starboard" />
            </div>
            <div class="form-group col-sm-1-2 col-lg-1-4">
              <label for="">Aft</label>
              <input
                type="number"
                class="form-control"
                v-model="params.ablativeArmorByPosition.aft" />
            </div>
          </div>

          <p v-if="ablativeArmorByPositionTotal != ablativeArmor.tempHp" class="text-danger">
            Make sure your ablative armor adds up to {{ ablativeArmor.tempHp }}.
          </p>

          <p v-if="!isAblativeArmorBalanced" class="text-warning">
            NOTE: The ship has a -1 penalty to Piloting because temporary HP from ablative armor is
            not balanced.
          </p>

          <p v-if="ablativeArmor.tempHp > hp" class="text-warning">
            NOTE: The ship has a -1 penalty to Piloting because temporary HP exceeds the ship&apos;s
            HP.
          </p>
        </div>

        <div class="box__info">
          <strong>Temporary HP</strong> {{ ablativeArmor.tempHp }}; <strong>TL Modifier</strong>
          {{ ablativeArmor.tlMod }}; <strong>Turn Distance</strong> {{ ablativeArmor.turnMod }}
        </div>

        <div class="box__cost">
          <svg class="icon">
            <use xlink:href="#icon-build" />
          </svg>
          {{ ablativeArmor.bpCost }}
        </div>
      </div>
      <!--
      <FortifiedHull />
      | - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      |  FORTIFIED HULL
      | - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      -->

      <div class="box" v-if="params.sourcesInUse.som == true">
        <header class="box__header">
          <h3 id="fortified-hull">Fortified Hull</h3>
        </header>
        <div class="box__select">
          <div class="form-group">
            <label for="fortifiedHullSelect">Fortified Hull</label>
            <select v-model="params.fortifiedHullId" id="fortifiedHullSelect" class="form-control">
              <option v-for="option in selectOptions.fortifiedHull" :value="option.id">
                {{ option.name }}
              </option>
            </select>
          </div>
        </div>
        <div class="box__info"><strong>Bonus To CT</strong> {{ fortifiedHull.bonusToCt }}</div>
        <div class="box__cost">
          <svg class="icon">
            <use xlink:href="#icon-build" />
          </svg>
          {{ fortifiedHull.bpCost }}
        </div>
      </div>
      <!--
      <ReinforcedBulkhead />
      | - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      |  REINFORCED BULKHEAD
      | - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      -->

      <div class="box" v-if="params.sourcesInUse.som == true">
        <header class="box__header">
          <h3 id="reinforced-bulkhead">Reinforced Bulkhead</h3>
        </header>
        <div class="box__select">
          <div class="form-group">
            <label for="reinforcedBulkheadSelect">Reinforced Bulkhead</label>
            <select
              id="reinforcedBulkheadSelect"
              class="form-control"
              v-model="params.reinforcedBulkheadId">
              <option v-for="option in selectOptions.reinforcedBulkhead" :value="option.id">
                {{ option.name }}
              </option>
            </select>
          </div>
        </div>
        <div class="box__info">
          <strong>Fortification</strong> {{ reinforcedBulkhead.fortification }}
        </div>
        <div class="box__cost">
          <svg class="icon">
            <use xlink:href="#icon-build" />
          </svg>
          {{ reinforcedBulkhead.bpCost }}
        </div>
      </div>
      <!--
      <Computer />
      | - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      |  COMPUTER
      | - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      -->

      <div class="box">
        <header class="box__header">
          <h3 id="computer">Computer</h3>
        </header>
        <div class="box__select">
          <div class="form-group">
            <label for="computerSelect">Computer</label>
            <select
              name="computer"
              id="computerSelect"
              class="form-control"
              v-model="params.computerId">
              <option v-for="option in selectOptionsComputer" :value="option.id">
                {{ params.sourcesInUse.dnd ? option.dnd.name : option.name }}
              </option>
            </select>
          </div>

          <!-- network node (Supercolossal ships only) -->
          <div class="form-group" v-if="isSupercolossal">
            <label for="ctNetworkNodes">Network Nodes</label>
            <input
              type="number"
              min="0"
              :max="networkNodes.max"
              id="ctNetworkNodes"
              v-model="params.ctNetworkNodes"
              class="form-control" />
          </div>

          <!-- secondary computer (Supercolossal ships only) -->
          <div class="form-group" v-if="isSupercolossal">
            <label for="secondaryComputerSelect">Secondary Computer</label>
            <select
              name="secondaryComputer"
              id="secondaryComputerSelect"
              class="form-control"
              v-model="params.secondaryComputerId">
              <option v-for="option in selectOptionsSecondaryComputer" :value="option.id">
                {{ params.sourcesInUse.dnd ? option.dnd.name : option.name }}
              </option>
            </select>
          </div>

          <!-- dedicated computer -->
          <div class="form-group" v-if="params.sourcesInUse.som && hasDedicatedComputerHousing">
            <label for="dedicatedComputerSelect">Dedicated Computer</label>
            <select
              name="dedicatedComputer"
              id="dedicatedComputerSelect"
              class="form-control"
              v-model="params.dedicatedComputerId">
              <option v-for="option in selectOptionsDedicatedComputer" :value="option.id">
                {{ params.sourcesInUse.dnd ? option.dnd.name : option.name }}
              </option>
            </select>
          </div>
        </div>

        <div class="box__info">
          <strong>Skill Bonus</strong> {{ computerSkillBonusDesc }}
          <span v-if="params.sourcesInUse.som && hasDedicatedComputerHousing">
            <strong>Dedicated Computer Skill Bonus</strong>
            {{ getPrefixedModifier(dedicatedComputerBonus) }}
          </span>
          <strong>Nodes</strong> {{ ctComputerNodes }}
          <span v-if="!params.sourcesInUse.dnd">
            <strong>Computer Tier</strong>
            {{ computerTier }}
          </span>
        </div>

        <div class="box__cost">
          <svg class="icon">
            <use xlink:href="#icon-power" />
          </svg>
          {{
            computer.pcuCost +
            dedicatedComputer.pcuCost +
            (isSupercolossal ? secondaryComputer.pcuCost : 0) +
            networkNodes.pcuCost
          }}
          <svg class="icon">
            <use xlink:href="#icon-build" />
          </svg>
          {{
            computer.bpCost +
            dedicatedComputer.bpCost +
            (isSupercolossal ? secondaryComputer.bpCost : 0) +
            networkNodes.bpCost
          }}
        </div>
      </div>
      <!--
      <Defenses />
      | - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      |  DEFENSIVE COUNTERMEASURES
      | - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      -->

      <div class="box">
        <header class="box__header">
          <h3 id="defensiveCountermeasures">Defensive Countermeasures</h3>
        </header>
        <div class="box__select">
          <div class="form-group">
            <label for="defensiveCountermeasuresSelect">Defensive Countermeasures</label>
            <select
              v-model="params.defensiveCountermeasuresId"
              id="defensiveCountermeasuresSelect"
              class="form-control">
              <option v-for="option in selectOptions.defensiveCountermeasures" :value="option.id">
                {{ option.name }}
              </option>
            </select>
          </div>

          <!-- special materials -->
          <div class="form" v-if="params.sourcesInUse.som">
            <div class="form-group">
              Special Material:
              <!-- none -->
              <div class="radio">
                <label>
                  <input
                    type="radio"
                    name="defensiveCountermeasuresMaterialId"
                    value="none"
                    v-model="params.defensiveCountermeasuresMaterialId" />
                  None
                </label>
              </div>
              <!-- horacalcum -->
              <div class="radio">
                <label>
                  <input
                    type="radio"
                    name="defensiveCountermeasuresMaterialId"
                    value="horacalcum"
                    v-model="params.defensiveCountermeasuresMaterialId" />
                  Horacalcum (decrease enemy weapon speed by 25%)
                </label>
              </div>
              <!-- siccatite -->
              <div class="radio">
                <label>
                  <input
                    type="radio"
                    name="defensiveCountermeasuresMaterialId"
                    value="siccatite"
                    v-model="params.defensiveCountermeasuresMaterialId" />
                  Siccatite (increase science officer Computers DC against enemy sensors)
                </label>
              </div>
            </div>
          </div>
          <!-- special materials -->
        </div>
        <div class="box__info">
          <strong>Bonus To TL</strong>
          {{ getPrefixedModifier(defensiveCountermeasuresBonus) }}
        </div>
        <div class="box__cost">
          <svg class="icon">
            <use xlink:href="#icon-power" />
          </svg>
          {{ defensiveCountermeasuresPcuCost }}
          <svg class="icon">
            <use xlink:href="#icon-build" />
          </svg>
          {{ defensiveCountermeasuresBpCost }}
        </div>
      </div>
      <!--
      <DriftEngines />
      | - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      |  DRIFT ENGINE
      | - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      -->

      <div class="box">
        <header class="box__header">
          <h3 id="driftEngine">Hyperdrive</h3>
        </header>
        <div class="box__select">
          <div class="form-group">
            <label for="driftEngineSelect">Hyperdrive</label>
            <select id="driftEngineSelect" class="form-control" v-model="params.driftEngineId">
              <option v-for="option in selectOptionsDriftEngine" :value="option.id">
                {{ option.name }}
              </option>
            </select>
          </div>
        </div>
        <div class="box__info" v-if="driftEngine.notes !== undefined">
          <em>Note: </em>{{ driftEngine.notes }}
        </div>
        <div class="box__info"><strong>Hyperdrive Rating</strong> {{ driftEngine.engineRating }}</div>
        <div class="box__cost">
          <svg class="icon">
            <use xlink:href="#icon-build" />
          </svg>
          {{ driftEngineBpCost }}
        </div>
      </div>
      <!--
      <ExpansionBays />
      | - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      |  EXPANSION BAYS
      | - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      -->

      <div class="box" v-if="frame.expansionBays !== 0">
        <header class="box__header">
          <h3 id="expansionBays">Expansion Bays</h3>
        </header>
        <p v-if="frame.expansionBayInfo" class="text-warning">
          NOTE: {{ frame.expansionBayInfo }}.
        </p>
        <p v-if="sizeCategory.id == 'Supercolossal'" class="text-warning">
          NOTE: As a Supercolossal ship, this vessel has {{ Math.floor(frame.bpCost / 10) }} cargo
          bays in addition to those below.
        </p>
        <p
          v-if="
            params.sourcesInUse.som &&
            sizeCategory.multiplier >= 4 &&
            (params.hasColonyShipFramework || params.hasSpaceStationFramework)
          "
          class="text-warning">
          NOTE: On a colony ship or space station, two thirds of expansion bays must be for civilian
          use (cargo holds, escape pods, guest quarters, life boats, recreation suites, or others
          determined by the GM).
        </p>
        <div class="cost__item">
          <span class="cost__name">Slots used</span>
          <span class="cost__values">
            <span
              class="cost__current"
              v-bind:class="{ 'cost__current--danger': isExpansionBaysCountOverBudget }"
              >{{ expansionBaysCountUsed }}</span
            >
            /
            <span class="cost__budget">{{ ctExpansionBaySlots }}</span>
          </span>
        </div>
        <ul class="box__select">
          <template v-for="(expansionBay, i) in expansionBays">
            <li>
              <div class="box__header--btns">
                <h4>
                  <label :for="'expansionBaySelect' + i">Expansion Bay {{ i + 1 }}</label>
                </h4>
                <div>
                  <!-- duplicate -->
                  <button
                    class="btn btn-primary btn-sm"
                    :disabled="
                      params.isUseStrictRules &&
                      frame.expansionBays != 'Unlimited' &&
                      expansionBaysCountUsed >= ctExpansionBaySlots
                    "
                    @click="params.expansionBayIds.splice(i + 1, 0, params.expansionBayIds[i])">
                    <svg class="icon">
                      <use xlink:href="#icon-duplicate" />
                    </svg>
                  </button>

                  <!-- delete -->
                  <button
                    class="btn btn-danger btn-sm"
                    @click="params.expansionBayIds.splice(i, 1)">
                    <svg class="icon">
                      <use xlink:href="#icon-trash" />
                    </svg>
                  </button>
                </div>
              </div>

              <!-- select -->
              <div class="form-group">
                <select
                  v-model="params.expansionBayIds[i]"
                  :id="'expansionBaySelect' + i"
                  class="form-control">
                  <option v-for="option in selectOptions.expansionBay" :value="option.id">
                    {{
                      option.name + (option.numBays != 1 ? ' (' + option.numBays + ' Slots)' : '')
                    }}
                  </option>
                </select>
              </div>

              <p
                v-if="frame.size == 'Supercolossal' && expansionBay.id == 'hangar-bay'"
                class="text-warning">
                NOTE: Expanding an existing hangar bay to accommodate eight more Medium ships
                increases the hangar bay’s cost by only 1 BP. Use Custom Components to expand your
                hangar bay.
              </p>

              <div class="box__cost--list">
                <svg class="icon">
                  <use xlink:href="#icon-power" />
                </svg>
                {{ getExpansionBayPcuCost(expansionBay) }}
                <svg class="icon">
                  <use xlink:href="#icon-build" />
                </svg>
                {{ getExpansionBayBpCost(expansionBay) }}
              </div>
            </li>
          </template>
        </ul>

        <p v-if="ctExternalExpansionBays > frame.expansionBays" class="text-danger">
          You cannot have more external expansion bays than expansion bay slots on the frame.
        </p>

        <p v-if="hasHealingPod" class="text-warning">
          NOTE: Healing pods can only be installed on biomechanical ships.
        </p>

        <div class="box__under-box align-right">
          <button @click="params.expansionBayIds.push('none')" class="btn btn-primary">
            Create New Expansion Bay
          </button>
        </div>

        <div class="box__cost">
          <svg class="icon">
            <use xlink:href="#icon-power" />
          </svg>
          {{ expansionBaysTotalPcuCost }}
          <svg class="icon">
            <use xlink:href="#icon-build" />
          </svg>
          {{ expansionBaysTotalBpCost }}
        </div>
      </div>
      <!--
      <Security />
      | - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      |  SECURITY
      | - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      -->

      <div class="box">
        <header class="box__header">
          <h3 id="security">Security</h3>
        </header>

        <!-- Anti-Hacking Systems -->
        <div class="box__list-item">
          <div class="box__select">
            <div class="form-group">
              <label for="antiHackingSystemsSelect">Anti-Hacking Systems</label>
              <select
                v-model="params.antiHackingSystemsId"
                id="antiHackingSystemsSelect"
                class="form-control">
                <template v-for="option in selectOptions.antiHackingSystems">
                  <option :value="option.id">{{ option.name }}</option>
                </template>
              </select>
            </div>
          </div>
          <div class="box__cost--list">
            <svg class="icon">
              <use xlink:href="#icon-build" />
            </svg>
            {{ antiHackingSystems.bpCost }}
          </div>
        </div>

        <!-- Anti-Personnel Weapon -->
        <div class="box__list-item" v-if="!params.isUseStrictRules || sizeCategory.multiplier <= 3">
          <div class="box__select">
            <div class="form-group">
              <label for="antiPersonnelWeaponSelect">Anti-Personnel Weapon</label>
              <select
                v-model="params.antiPersonnelWeaponId"
                id="antiPersonnelWeaponSelect"
                class="form-control">
                <template v-for="option in selectOptionsPersonalWeapon">
                  <option :value="option.id">{{ option.name }} ({{ option.damage }})</option>
                </template>
              </select>
            </div>
          </div>
          <div class="box__cost--list">
            <svg class="icon">
              <use xlink:href="#icon-build" />
            </svg>
            {{ antiPersonnelWeaponBpCost }}
          </div>
        </div>

        <!-- Biometric Locks -->
        <div class="box__list-item">
          <div class="box__select">
            <div class="checkbox">
              <label for="hasBiometricLocks">
                <input type="checkbox" v-model="params.hasBiometricLocks" id="hasBiometricLocks" />
                Biometric Locks
              </label>
            </div>
          </div>
          <div class="box__cost--list">
            <svg class="icon">
              <use xlink:href="#icon-build" />
            </svg>
            {{ biometricLocksBpCost }}
          </div>
        </div>

        <!-- Computer Countermeasures -->
        <div class="box__list-item">
          <p>Computer Countermeasures</p>

          <div class="box__select">
            <!-- true/false countermeasures -->
            <div class="box__select box__select--computerCountermeasures">
              <div class="checkbox" v-for="option in selectOptionsComputerCountermeasures">
                <label :for="'computerCountermeasures_' + option.id">
                  <input
                    type="checkbox"
                    v-model="params.computerCountermeasures[option.id]"
                    :id="'computerCountermeasures_' + option.id" />
                  {{ option.name }}
                </label>
              </div>
            </div>

            <!-- shock grid -->
            <div class="form-group">
              <label for="shockGridSelect">Shock Grid</label>
              <select
                v-model="params.computerCountermeasures.shockGridId"
                id="shockGridSelect"
                class="form-control">
                <option v-for="option in selectOptions.shockGrid" :value="option.id">
                  {{
                    option.id == 'none'
                      ? 'None'
                      : option.name + ' (DC ' + option.dc + ', ' + option.damage + ')'
                  }}
                </option>
              </select>
            </div>
          </div>

          <div class="box__cost--list">
            <svg class="icon">
              <use xlink:href="#icon-build" />
            </svg>
            {{ computerCountermeasuresBpCost }}
          </div>
        </div>

        <!-- Self-Destruct System -->
        <div class="box__list-item">
          <div class="box__select">
            <div class="checkbox">
              <label for="hasSelfDestructSystem">
                <input
                  type="checkbox"
                  v-model="params.hasSelfDestructSystem"
                  id="hasSelfDestructSystem" />
                Self-Destruct System
              </label>
            </div>
          </div>
          <div class="box__cost--list">
            <svg class="icon">
              <use xlink:href="#icon-build" />
            </svg>
            {{ selfDestructSystemBpCost }}
          </div>
        </div>

        <!-- Emergency Accelerator -->
        <div class="box__list-item">
          <div class="box__select">
            <div class="checkbox">
              <label for="hasEmergencyAccelerator">
                <input
                  type="checkbox"
                  v-model="params.hasEmergencyAccelerator"
                  id="hasEmergencyAccelerator" />
                Emergency Accelerator
              </label>
            </div>
          </div>
          <div class="box__cost--list">
            <svg class="icon">
              <use xlink:href="#icon-power" />
            </svg>
            {{ params.hasEmergencyAccelerator ? 5 : 0 }}
            <svg class="icon">
              <use xlink:href="#icon-build" />
            </svg>
            {{ params.hasEmergencyAccelerator ? 4 * sizeCategory.multiplier : 0 }}
          </div>
        </div>

        <!-- Holographic Mantle -->
        <div class="box__list-item">
          <div class="box__select">
            <div class="checkbox">
              <label for="hasHolographicMantle">
                <input
                  type="checkbox"
                  v-model="params.hasHolographicMantle"
                  id="hasHolographicMantle" />
                Holographic Mantle
              </label>
            </div>
          </div>
          <div class="box__cost--list">
            <svg class="icon">
              <use xlink:href="#icon-power" />
            </svg>
            {{ params.hasHolographicMantle ? 10 : 0 }}
            <svg class="icon">
              <use xlink:href="#icon-build" />
            </svg>
            {{ params.hasHolographicMantle ? 12 : 0 }}
          </div>
        </div>

        <!-- Reconfiguration System -->
        <div class="box__list-item">
          <div class="box__select">
            <div class="checkbox">
              <label for="hasReconfigurationSystem">
                <input
                  type="checkbox"
                  v-model="params.hasReconfigurationSystem"
                  id="hasReconfigurationSystem" />
                Reconfiguration System
              </label>
            </div>
          </div>
          <div class="box__cost--list">
            <svg class="icon">
              <use xlink:href="#icon-power" />
            </svg>
            {{ params.hasReconfigurationSystem ? 50 : 0 }}
            <svg class="icon">
              <use xlink:href="#icon-build" />
            </svg>
            {{ params.hasReconfigurationSystem ? 30 : 0 }}
          </div>
        </div>

        <!-- Total -->
        <div class="box__cost">
          <svg class="icon">
            <use xlink:href="#icon-power" />
          </svg>
          {{ securityTotalPcuCost }}
          <svg class="icon">
            <use xlink:href="#icon-build" />
          </svg>
          {{ securityTotalBpCost }}
        </div>
      </div>
      <!--
      <Sensors />
      | - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      |  SENSORS
      | - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      -->

      <div class="box">
        <header class="box__header">
          <h3 id="sensors">Sensors</h3>
        </header>
        <div class="box__select">
          <div class="form-group">
            <label for="sensorsSelect">Sensors</label>
            <select v-model="params.sensorsId" id="sensorsSelect" class="form-control">
              <option v-for="option in selectOptions.sensors" :value="option.id">
                {{ option.name }}
              </option>
            </select>
          </div>

          <!-- special materials -->
          <div class="form" v-if="params.sourcesInUse.som">
            <div class="form-group">
              Special Material:
              <!-- none -->
              <div class="radio">
                <label>
                  <input
                    type="radio"
                    name="sensorsMaterialId"
                    value="none"
                    v-model="params.sensorsMaterialId" />
                  None
                </label>
              </div>
              <!-- adamantine-alloy -->
              <div class="radio">
                <label>
                  <input
                    type="radio"
                    name="sensorsMaterialId"
                    value="djezet"
                    v-model="params.sensorsMaterialId" />
                  Djezet (increase sensor range)
                </label>
              </div>
              <!-- noqual -->
              <div class="radio">
                <label>
                  <input
                    type="radio"
                    name="sensorsMaterialId"
                    value="noqual"
                    v-model="params.sensorsMaterialId" />
                  Noqual (chance to cause enemy glitch on scan crew action)
                </label>
              </div>
            </div>
          </div>
          <!-- special materials -->
        </div>
        <div class="box__info">
          <strong>Range</strong> {{ sensors.range }}; <strong>Modifier</strong>
          {{ getPrefixedModifier(sensors.modifier) }}
        </div>
        <div class="box__cost">
          <svg class="icon">
            <use xlink:href="#icon-build" />
          </svg>
          {{ sensorsBpCost }}
        </div>
      </div>
      <!--
      <Shields />
      | - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      |  SHIELDS
      | - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      -->

      <div class="box">
        <header class="box__header">
          <h3 id="shields">Shields</h3>
        </header>

        <!-- select shield type -->
        <div class="form" v-if="params.sourcesInUse.som">
          Shield Type:
          <div class="radio">
            <label>
              <input type="radio" name="shieldType" value="shields" v-model="params.shieldType" />
              Shields (Core Rulebook)
            </label>
          </div>
          <div class="radio">
            <label>
              <input
                type="radio"
                name="shieldType"
                value="deflector-shield"
                v-model="params.shieldType" />
              Deflector Shields (Starship Operations Manual)
            </label>
          </div>
        </div>

        <!-- Core Rulebook Shields -->
        <div v-if="!params.sourcesInUse.som || params.shieldType == 'shields'">
          <div class="box__select">
            <div class="form-group">
              <label for="shieldsSelect">Shields</label>
              <select
                v-model="params.shieldsId"
                id="shieldsSelect"
                class="form-control"
                @change="setDefaultPositionDependentValues('shields', 'totalSp')">
                <option v-for="option in selectOptions.shields" :value="option.id">
                  {{ option.name }}
                </option>
              </select>
            </div>

            <h4>Shields by position:</h4>
            <div class="box--flex">
              <div class="form-group col-sm-1-2 col-lg-1-4">
                <label for="">Forward</label>
                <input
                  type="number"
                  class="form-control"
                  v-model="params.shieldsByPosition.forward" />
              </div>
              <div class="form-group col-sm-1-2 col-lg-1-4">
                <label for="">Port</label>
                <input type="number" class="form-control" v-model="params.shieldsByPosition.port" />
              </div>
              <div class="form-group col-sm-1-2 col-lg-1-4">
                <label for="">Starboard</label>
                <input
                  type="number"
                  class="form-control"
                  v-model="params.shieldsByPosition.starboard" />
              </div>
              <div class="form-group col-sm-1-2 col-lg-1-4">
                <label for="">Aft</label>
                <input type="number" class="form-control" v-model="params.shieldsByPosition.aft" />
              </div>
            </div>

            <p v-if="shieldsByPositionTotal != shields.totalSp" class="text-warning">
              Make sure your shields add up to {{ shields.totalSp }}!
            </p>
          </div>
          <div class="box__info">
            <strong>Total SP</strong> {{ shields.totalSp }}; <strong>Regen.</strong>
            {{ shields.regen }}
          </div>
          <div class="box__cost">
            <svg class="icon">
              <use xlink:href="#icon-power" />
            </svg>
            {{ shields.pcuCost }}
            <svg class="icon">
              <use xlink:href="#icon-build" />
            </svg>
            {{ shields.bpCost }}
          </div>
        </div>

        <!-- SOM Deflector Shields -->
        <div v-else>
          <div class="box__select">
            <div class="form-group">
              <label for="shieldsSelect">Deflector Shields</label>
              <select
                v-model="params.deflectorShieldId"
                id="deflectorShieldSelect"
                class="form-control">
                <option v-for="option in selectOptions.deflectorShield" :value="option.id">
                  {{ option.name }}
                </option>
              </select>
            </div>
          </div>
          <div class="box__info">
            <strong>Defense Value</strong> {{ deflectorShield.defenseValue }}/&ndash;;
            <strong>Bonus to AC</strong> +{{ deflectorShield.bonusToAc }};
            <strong>Bonus to TL</strong> +{{ deflectorShield.bonusToTl }}
          </div>
          <div class="box__cost">
            <svg class="icon">
              <use xlink:href="#icon-power" />
            </svg>
            {{ deflectorShield.pcuCost }}
            <svg class="icon">
              <use xlink:href="#icon-build" />
            </svg>
            {{ deflectorShield.bpCost }}
          </div>
        </div>
      </div>
      <!--
      <WeaponMounts />
      | - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      |  WEAPON MOUNTS
      | - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      -->

      <h3 id="weapons">Weapons</h3>

      <p v-if="frame.weaponInfo">FOR INFORMATION: {{ frame.weaponInfo }}.</p>

      <template v-for="(weaponList, position) in weaponMounts">
        <header class="box__header">
          <h4 id="weapons_test">
            {{ position.toTitleCase() + (position == 'turret' ? '' : ' Arc') }}
          </h4>
        </header>

        <template v-for="(weaponMount, i) in weaponList">
          <div class="box">
            <!-- Header, upgrade, downgrade, delete buttons -->
            <div class="box__header--btns">
              <h4>Weapon Mount {{ i + 1 }} ({{ weaponMount.weight }})</h4>
              <div>
                <button
                  class="btn btn-primary btn-sm"
                  :disabled="!weaponMount.canBeUpgraded"
                  @click="upgradeWeaponMount(position, i)">
                  <svg class="icon">
                    <use xlink:href="#icon-up" />
                  </svg>
                </button>
                <button
                  class="btn btn-primary btn-sm"
                  :disabled="!weaponMount.canBeDowngraded"
                  @click="downgradeWeaponMount(position, i)">
                  <svg class="icon">
                    <use xlink:href="#icon-down" />
                  </svg>
                </button>
                <button
                  class="btn btn-danger btn-sm"
                  :disabled="weaponMount.isFromTemplate"
                  @click="destroyWeaponMount(position, i)">
                  <svg class="icon">
                    <use xlink:href="#icon-trash" />
                  </svg>
                </button>
              </div>
            </div>

            <!-- Weapon select -->
            <div class="box__select">
              <div class="form-group">
                <label :for="'shipWeaponSelect_' + i">Weapon </label>
                <select
                  v-model="params.weaponMounts[position][i].weaponId"
                  :id="'shipWeaponSelect_' + i"
                  class="form-control"
                  @change="setWeaponLinking(position, i)">
                  <option value="none">None</option>
                  <optgroup v-for="weaponType in data.shipWeaponType.data" :label="weaponType">
                    <template v-for="option in selectOptionsShipWeapon(weaponType, weaponMount)">
                      <option :value="option.id">
                        {{ option.name }} ({{ option.damage }},
                        {{ getWeaponRangeNumerical(option) }}, PCU {{ option.pcuCost }}, BP
                        {{ option.bpCost }})
                      </option>
                    </template>
                  </optgroup>
                </select>
              </div>
              <!-- .form-group -->
            </div>
            <!-- .box__select -->

            <!-- Weapon info -->
            <div class="box__info">
              <strong>Range</strong> {{ weaponMount.weapon.range }}; <strong>Speed</strong>
              {{ weaponMount.weapon.speed }}; <strong>Damage</strong>
              {{ weaponMount.weapon.damage }};
              <strong>Special Properties</strong>
              {{
                getNamesFromIds(
                  'weaponSpecialProperty',
                  weaponMount.weapon.specialProperties,
                  'n/a'
                )
              }}
            </div>

            <!-- Special Materials -->
            <div class="form" v-if="params.sourcesInUse.som">
              <div class="form-group">
                Special Material:
                <!-- none -->
                <div class="radio">
                  <label>
                    <input
                      type="radio"
                      :name="'wpn-mount-special-material-' + position + '-' + i"
                      value="none"
                      v-model="params.weaponMounts[position][i].specialMaterial" />
                    None
                  </label>
                </div>
                <!-- abysium -->
                <div class="radio">
                  <label>
                    <input
                      type="radio"
                      :name="'wpn-mount-special-material-' + position + '-' + i"
                      value="abysium"
                      v-model="params.weaponMounts[position][i].specialMaterial" />
                    Abysium
                  </label>
                </div>
                <!-- adamantine alloy -->
                <div class="radio">
                  <label>
                    <input
                      type="radio"
                      :name="'wpn-mount-special-material-' + position + '-' + i"
                      value="adamantine-alloy"
                      v-model="params.weaponMounts[position][i].specialMaterial" />
                    Adamantine Alloy
                  </label>
                </div>
                <!-- inubrix -->
                <div class="radio">
                  <label>
                    <input
                      type="radio"
                      :name="'wpn-mount-special-material-' + position + '-' + i"
                      value="inubrix"
                      v-model="params.weaponMounts[position][i].specialMaterial" />
                    Inubrix
                  </label>
                </div>
              </div>
            </div>

            <!-- Is Linked -->
            <div class="box__select">
              <div class="checkbox">
                <label
                  :for="'isLinked_' + position + '_' + i"
                  v-if="params.weaponMounts[position][i].canBeLinked">
                  <input
                    type="checkbox"
                    v-model="params.weaponMounts[position][i].isLinked"
                    :id="'isLinked_' + position + '_' + i"
                    @change="setWeaponLinking(position)" />
                  Linked?
                </label>
              </div>
            </div>

            <!-- has orbital weapon discount (for colony ships and space stations)  -->
            <div
              class="box__select"
              v-if="
                params.sourcesInUse.som &&
                sizeCategory.multiplier >= 4 &&
                (params.hasColonyShipFramework || params.hasSpaceStationFramework) &&
                isOrbitalWeapon(weaponMount.weapon)
              ">
              <div class="checkbox">
                <label :for="'hasOrbitalDiscount_' + position + '_' + i">
                  <input
                    type="checkbox"
                    v-model="params.weaponMounts[position][i].hasOrbitalDiscount"
                    :disabled="
                      !params.weaponMounts[position][i].hasOrbitalDiscount &&
                      isOrbitalWeaponDiscountUsed
                    "
                    :id="'hasOrbitalDiscount_' + position + '_' + i" />
                  Has orbital weapon discount for colony ship or space station?
                </label>
              </div>
            </div>

            <!-- Weapon cost -->
            <div class="box__cost">
              <svg class="icon">
                <use xlink:href="#icon-power" />
              </svg>
              {{ weaponMount.weapon.pcuCost }}
              <svg class="icon">
                <use xlink:href="#icon-build" />
              </svg>
              {{
                weaponMount.bpCost +
                weaponMount.materialCost +
                weaponMount.mountBpCost +
                weaponMount.linkCost
              }}
              <span
                v-if="
                  weaponMount.materialCost > 0 ||
                  weaponMount.linkCost > 0 ||
                  weaponMount.mountBpCost > 0
                ">
                (weapon {{ weaponMount.bpCost }}
                <span v-if="weaponMount.materialCost > 0">
                  + material {{ weaponMount.materialCost }}
                </span>
                <span v-if="weaponMount.mountBpCost > 0">
                  + mount {{ weaponMount.mountBpCost }}
                </span>
                <span v-if="weaponMount.linkCost > 0"> + link {{ weaponMount.linkCost }} </span>)
              </span>
            </div>
          </div>
          <!-- .box -->
        </template>

        <div class="box__under-box align-right">
          <button
            @click="createWeaponMount(position)"
            :disabled="!canWeaponMountBeCreated(position)"
            class="btn btn-primary">
            Create New {{ position.toTitleCase() }} Mount
          </button>
        </div>
      </template>

      <div class="box">
        <header class="box__header">
          <h3 id="weapons">Weapons Summary</h3>
        </header>
        <div class="box__cost">
          <svg class="icon">
            <use xlink:href="#icon-power" />
          </svg>
          {{ weaponsTotalCosts.weaponsPcu }}
          <svg class="icon">
            <use xlink:href="#icon-build" />
          </svg>
          {{
            weaponsTotalCosts.weaponsBp +
            weaponsTotalCosts.weaponMaterialsBp +
            weaponsTotalCosts.weaponMountsBp +
            weaponsTotalCosts.weaponLinksBp
          }}
          (weapons {{ weaponsTotalCosts.weaponsBp }} + materials
          {{ weaponsTotalCosts.weaponMaterialsBp }} + mounts
          {{ weaponsTotalCosts.weaponMountsBp }} + links {{ weaponsTotalCosts.weaponLinksBp }})
        </div>
      </div>
      <!--
      <SystemsAndUpgrades />
      | - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      |  SYSTEMS AND UPGRADES
      | - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      -->

      <div id="other" class="box" v-if="params.sourcesInUse.pw || params.sourcesInUse.som">
        <header class="box__header">
          <h3 id="other">Systems and Upgrades</h3>
        </header>

        <!-- algal shielding -->
        <div v-if="params.sourcesInUse.som">
          <div class="box__select">
            <div class="checkbox">
              <label for="hasAlgalShielding">
                <input type="checkbox" v-model="params.hasAlgalShielding" id="hasAlgalShielding" />
                Algal Shielding (see <i>Starship Operations Manual</i>, p 27)
              </label>
            </div>
          </div>
          <div class="box__cost--list">
            <svg class="icon"><use xlink:href="#icon-build" /></svg>
            {{ params.hasAlgalShielding ? 5 + 2 * sizeCategory.multiplier : 0 }}
          </div>
        </div>

        <!-- algal shielding -->
        <div v-if="params.sourcesInUse.som">
          <div class="box__select">
            <div class="checkbox">
              <label for="hasAutoDestruct">
                <input type="checkbox" v-model="params.hasAutoDestruct" id="hasAutoDestruct" />
                Autodestruct System (see <i>Starship Operations Manual</i>, p 27)
              </label>
            </div>
          </div>
          <div class="box__cost--list">
            <svg class="icon"><use xlink:href="#icon-build" /></svg>
            {{ params.hasAutoDestruct ? sizeCategory.multiplier : 0 }}
          </div>
        </div>

        <!-- colony ship framework -->
        <div v-if="params.sourcesInUse.som && this.sizeCategory.multiplier >= 4">
          <!-- Large or higher -->
          <div class="box__select">
            <div class="checkbox">
              <label for="hasColonyShipFramework">
                <input
                  type="checkbox"
                  v-model="params.hasColonyShipFramework"
                  id="hasColonyShipFramework" />
                Colony Ship Framework (see <i>Starship Operations Manual</i>, p 27)
              </label>
            </div>
          </div>
          <div class="box__cost--list">
            <svg class="icon"><use xlink:href="#icon-build" /></svg>
            {{ params.hasColonyShipFramework ? Math.floor(frame.bpCost * 0.25) : 0 }}
          </div>
        </div>

        <!-- consciousness uplink drive -->
        <div v-if="params.sourcesInUse.som">
          <div class="box__select">
            <div class="checkbox">
              <label for="hasConsciousnessUplink">
                <input
                  type="checkbox"
                  v-model="params.hasConsciousnessUplink"
                  id="hasConsciousnessUplink" />
                Consciousness Uplink Drive (see <i>Starship Operations Manual</i>, p 28)
              </label>
            </div>
          </div>
          <div class="box__cost--list">
            <svg class="icon"><use xlink:href="#icon-build" /></svg>
            {{ params.hasConsciousnessUplink ? 4 : 0 }}
          </div>
        </div>

        <!-- data net -->
        <div v-if="params.sourcesInUse.pw">
          <div class="box__select">
            <div class="checkbox">
              <label for="hasDataNet">
                <input type="checkbox" v-model="params.hasDataNet" id="hasDataNet" />
                Data Net (see <i>Pact Worlds</i>, p152)
              </label>
            </div>
          </div>
          <div class="box__cost--list">
            <svg class="icon"><use xlink:href="#icon-build" /></svg> {{ dataNetBpCost }}
            <svg class="icon"><use xlink:href="#icon-build" /></svg> {{ dataNetPcuCost }}
          </div>
        </div>

        <!-- hive joining -->
        <div v-if="params.sourcesInUse.pw">
          <div class="box__select">
            <div class="checkbox">
              <label for="hasHiveJoining">
                <input type="checkbox" v-model="params.hasHiveJoining" id="hasHiveJoining" />
                Hive Joining (see <em>Pact Worlds</em>, p152)
              </label>
            </div>
          </div>
          <div class="box__cost--list">
            <svg class="icon"><use xlink:href="#icon-build" /></svg> {{ hiveJoiningBpCost }}
          </div>
        </div>

        <!-- powersap -->
        <div v-if="params.sourcesInUse.som">
          <div class="box__select">
            <div class="checkbox">
              <label for="hasPowersap">
                <input type="checkbox" v-model="params.hasPowersap" id="hasPowersap" />
                Powersap (see <i>Starship Operations Manual</i>, p 29)
              </label>
            </div>
          </div>
          <div class="box__cost--list">
            <svg class="icon"><use xlink:href="#icon-build" /></svg>
            {{ params.hasPowersap ? sizeCategory.multiplier * 3 : 0 }}
          </div>
        </div>

        <!-- robotic appendage -->
        <div v-if="params.sourcesInUse.som">
          <div class="box__select">
            <div class="form-group">
              <label for="roboticAppendageSelect">Robotic Appendage</label>
              <select
                name="roboticAppendage"
                id="roboticAppendageSelect"
                class="form-control"
                v-model="params.roboticAppendageId">
                <option v-for="option in selectOptions.roboticAppendage" :value="option.id">
                  {{ option.name }}
                </option>
              </select>
            </div>
          </div>
          <div class="box__cost--list">
            <svg class="icon"><use xlink:href="#icon-build" /></svg> {{ roboticAppendage.bpCost }}
          </div>
        </div>

        <!-- root system -->
        <div v-if="params.sourcesInUse.som">
          <div class="box__select">
            <div class="checkbox">
              <label for="hasRootSystem">
                <input type="checkbox" v-model="params.hasRootSystem" id="hasRootSystem" />
                Root System (see <i>Starship Operations Manual</i>, p 29)
              </label>
            </div>
          </div>
          <div class="box__cost--list">
            <svg class="icon"><use xlink:href="#icon-power" /></svg>
            {{ params.hasRootSystem ? 5 : 0 }}
            <svg class="icon"><use xlink:href="#icon-build" /></svg>
            {{ params.hasRootSystem ? sizeCategory.multiplier * 2 : 0 }}
          </div>
        </div>

        <!-- space station framework -->
        <div v-if="params.sourcesInUse.som && sizeCategory.multiplier >= 4">
          <div class="box__select">
            <div class="checkbox">
              <label for="hasSpaceStationFramework">
                <input
                  type="checkbox"
                  v-model="params.hasSpaceStationFramework"
                  id="hasSpaceStationFramework" />
                Space Station Framework (see <i>Starship Operations Manual</i>, p 29)
              </label>
            </div>
          </div>
          <div class="box__cost--list">
            <svg class="icon"><use xlink:href="#icon-build" /></svg>
            {{ params.hasSpaceStationFramework ? Math.floor(frame.bpCost * 0.2) : 0 }}
          </div>
        </div>

        <!-- training interface modules -->
        <div v-if="params.sourcesInUse.som">
          <p>Training Interface Modules</p>
          <div class="box--flex">
            <!-- tim -->
            <div class="form-group col-lg-1-2">
              <label for="ctTim">Number of TIMs</label>
              <input
                name="ctTim"
                id="ctTim"
                class="form-control"
                type="number"
                min="0"
                v-model="params.ctTim"
                @change="maybeAdjustCtTim('ctTim')" />
            </div>
            <!-- tim__all -->
            <div class="form-group col-lg-1-2">
              <label for="ctTimAll">of which have Associated Crew Member &ldquo;All&rdquo;</label>
              <input
                name="ctTimAll"
                id="ctTimAll"
                class="form-control"
                type="number"
                min="0"
                v-model="params.ctTimAll"
                @change="maybeAdjustCtTim('ctTimAll')" />
            </div>
          </div>
          <div class="box__cost--list">
            <svg class="icon"><use xlink:href="#icon-build" /></svg> {{ timBpCost }}
          </div>
        </div>

        <!-- virtual intelligence -->
        <div v-if="params.sourcesInUse.som">
          <div class="box__select">
            <div class="form-group">
              <label for="viSelect">Virtual Intelligence</label>
              <select name="vi" id="viSelect" class="form-control" v-model="params.viId">
                <option v-for="option in selectOptionsVI" :value="option.id">
                  {{ option.id == 'none' ? 'None' : 'Tier ' + option.name }}
                </option>
              </select>
            </div>
          </div>
          <div class="box__cost--list">
            <svg class="icon"><use xlink:href="#icon-build" /></svg> {{ vi.bpCost }}
          </div>
        </div>

        <!-- VI upgrade: holographic projector -->
        <div v-if="params.sourcesInUse.som && params.viId != 'none'">
          <div class="box__select">
            <div class="form-group">
              <label for="viHoloProjectorSelect">VI Upgrade: Holographic Projector</label>
              <select
                name="viHoloProjector"
                id="viHoloProjectorSelect"
                class="form-control"
                v-model="params.viHoloProjectorId">
                <option v-for="option in selectOptions.viHoloProjector" :value="option.id">
                  {{ option.name }}
                </option>
              </select>
            </div>
          </div>
          <div class="box__info"><strong>Maximum Size</strong> {{ viHoloProjectorSize }}</div>
          <div class="box__cost--list">
            <svg class="icon"><use xlink:href="#icon-build" /></svg> {{ viHoloProjector.bpCost }}
          </div>
        </div>

        <!-- VI upgrade: skill expander -->
        <div v-if="params.sourcesInUse.som && params.viId != 'none'">
          <div class="box__select">
            <div class="form-group">
              <label for="viSkillExpanderSelect">VI Upgrade: Skill Expander</label>
              <select
                name="viSkillExpander"
                id="viSkillExpanderSelect"
                class="form-control"
                v-model="params.viSkillExpanderId">
                <option v-for="option in selectOptions.viSkillExpander" :value="option.id">
                  {{ option.name }}
                </option>
              </select>
            </div>
          </div>
          <div class="box__cost--list">
            <svg class="icon"><use xlink:href="#icon-build" /></svg> {{ viSkillExpander.bpCost }}
          </div>
        </div>

        <!-- afterburners -->
        <div v-if="params.sourcesInUse.dnd">
          <div class="box__select">
            <div class="checkbox">
              <label for="hasAfterburners">
                <input type="checkbox" v-model="params.hasAfterburners" id="hasAfterburners" />
                Afterburners (see <i>Dark Matter</i>, p 166)
              </label>
            </div>
          </div>
          <div class="box__cost--list">
            <svg class="icon"><use xlink:href="#icon-power" /></svg>
            {{ params.hasAfterburners ? 2 : 0 }}
            <svg class="icon"><use xlink:href="#icon-build" /></svg>
            {{ params.hasAfterburners ? 2 : 0 }}
          </div>
        </div>

        <!-- Captain's Chair -->
        <div v-if="params.sourcesInUse.dnd">
          <div class="box__select">
            <div class="checkbox">
              <label for="hasCaptainsChair">
                <input type="checkbox" v-model="params.hasCaptainsChair" id="hasCaptainsChair" />
                Captain's Chair (see <i>Dark Matter</i>, p 166)
              </label>
            </div>
          </div>
          <div class="box__cost--list">
            <svg class="icon"><use xlink:href="#icon-build" /></svg>
            {{ params.hasCaptainsChair ? 2 : 0 }}
          </div>
        </div>

        <!-- Dead Reckoner -->
        <div v-if="params.sourcesInUse.dnd">
          <div class="box__select">
            <div class="checkbox">
              <label for="hasDeadReckoner">
                <input type="checkbox" v-model="params.hasDeadReckoner" id="hasDeadReckoner" />
                Dead Reckoner (see <i>Dark Matter</i>, p 166)
              </label>
            </div>
          </div>
          <div class="box__cost--list">
            <svg class="icon"><use xlink:href="#icon-power" /></svg>
            {{ params.hasDeadReckoner ? 2 : 0 }}
            <svg class="icon"><use xlink:href="#icon-build" /></svg>
            {{ params.hasDeadReckoner ? 2 : 0 }}
          </div>
        </div>

        <!-- Radio Array -->
        <div v-if="params.sourcesInUse.dnd">
          <div class="box__select">
            <div class="checkbox">
              <label for="hasRadioArray">
                <input type="checkbox" v-model="params.hasRadioArray" id="hasRadioArray" />
                Radio Array (see <i>Dark Matter</i>, p 167)
              </label>
            </div>
          </div>
          <div class="box__cost--list">
            <svg class="icon"><use xlink:href="#icon-power" /></svg>
            {{ params.hasRadioArray ? 1 : 0 }}
            <svg class="icon"><use xlink:href="#icon-build" /></svg>
            {{ params.hasRadioArray ? 1 : 0 }}
          </div>
        </div>

        <!-- Repair Drones -->
        <div v-if="params.sourcesInUse.dnd">
          <div class="box__select">
            <div class="checkbox">
              <label for="hasRepairDrones">
                <input type="checkbox" v-model="params.hasRepairDrones" id="hasRepairDrones" />
                Repair Drones (see <i>Dark Matter</i>, p 167)
              </label>
            </div>
          </div>
          <div class="box__cost--list">
            <svg class="icon"><use xlink:href="#icon-power" /></svg>
            {{ params.hasRepairDrones ? 5 : 0 }}
            <svg class="icon"><use xlink:href="#icon-build" /></svg>
            {{ params.hasRepairDrones ? 10 : 0 }}
          </div>
        </div>

        <!-- Sensor Probe -->
        <div v-if="params.sourcesInUse.dnd">
          <div class="box__select">
            <div class="checkbox">
              <label for="hasSensorProbe">
                <input type="checkbox" v-model="params.hasSensorProbe" id="hasSensorProbe" />
                Sensor Probe (see <i>Dark Matter</i>, p 164)
              </label>
            </div>
          </div>
          <div class="box__cost--list">
            <svg class="icon"><use xlink:href="#icon-power" /></svg>
            {{ params.hasSensorProbe ? 5 : 0 }}
            <svg class="icon"><use xlink:href="#icon-build" /></svg>
            {{ params.hasSensorProbe ? 5 : 0 }}
          </div>
        </div>

        <!-- end systems and upgrades -->
      </div>
      <!--
      <CustomComponents />
      | - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      |  CUSTOM COMPONENTS
      | - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      -->

      <div class="box">
        <header class="box__header">
          <h2 id="custom-components">Step 5a: Custom Components</h2>
        </header>

        <template v-for="(customComponent, index) in params.customComponents">
          <!-- delete button -->
          <div class="box__header--btns">
            <h4>{{ customComponent.name ? customComponent.name : 'New Custom Component' }}</h4>
            <div>
              <button class="btn btn-danger btn-sm" @click="removeCustomComponent(index)">
                <svg class="icon"><use xlink:href="#icon-trash" /></svg>
              </button>
            </div>
          </div>

          <!-- component name -->
          <div class="form-group">
            <label :for="'customComponentName' + index">Component Name</label>
            <input
              type="text"
              :id="'customComponentName' + index"
              v-model="customComponent.name"
              class="form-control" />
          </div>

          <!-- notes -->
          <div class="form-group">
            <label for="'customComponentNotes' + index">Notes</label>
            <textarea
              id="'customComponentNotes' + index"
              cols="30"
              rows="2"
              v-model="customComponent.notes"
              class="form-control"></textarea>
          </div>

          <!-- is essential -->
          <div class="checkbox">
            <label>
              <input
                type="checkbox"
                :id="'isEssential' + index"
                v-model="customComponent.isEssential" />
              Is this an essential system?
            </label>
          </div>

          <div class="box--flex">
            <!-- PCU -->
            <div class="form-group col-sm-1-1 col-lg-1-2">
              <label for="'customComponentPcuCost' + index">PCU Cost</label>
              <input
                type="number"
                :id="'customComponentPcuCost' + index"
                class="form-control"
                v-model="customComponent.pcuCost" />
            </div>

            <!-- BP -->
            <div class="form-group col-sm-1-1 col-lg-1-2">
              <label for="'customComponentBpCost' + index">BP Cost</label>
              <input
                type="number"
                :id="'customComponentBpCost' + index"
                class="form-control"
                v-model="customComponent.bpCost" />
            </div>
          </div>
        </template>

        <!-- Totals -->

        <div class="box__cost">
          <svg class="icon"><use xlink:href="#icon-power" /></svg>
          {{
            parseInt(customComponentPcuTotal.essential) +
            parseInt(customComponentPcuTotal.nonEssential)
          }}
          <svg class="icon"><use xlink:href="#icon-build" /></svg>
          {{ parseInt(customComponentBpTotal) }}
        </div>
      </div>

      <div class="box__under-box align-right">
        <button @click="createCustomComponent()" class="btn btn-primary">
          Create New Custom Component
        </button>
      </div>
      <!--
      <Footer />
      | - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      |  FOOTER
      | - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      -->
      <footer>
        <ul>
          <li>
            Starforger RPG Ship Builder by
            <a href="mailto:dennyw17@gmail.com">Denny Wright</a> &bull; March 2023
          </li>
          <li>
            Original Starfinder RPG Ship Builder by
            <a href="http://www.jamesturneronline.net">James Turner</a> &bull;
            <a href="https://twitter.com/james_c_turner">@james_c_turner</a> &bull; Sep 2017 (last
            updated September 2020)
          </li>
          <li>
            <a href="https://magehandpress.com/product/dark-matter-pdf">Dark Matter</a> &copy; Mage
            Hand Press LLC
          </li>
          <li><a href="http://paizo.com/starfinder/">Starfinder RPG</a> &copy; Paizo Inc, 2017</li>
          <li>Open Game Licence</li>
          <li>Made with <a href="https://vuejs.org/">Vue.js</a></li>
          <li>
            Visit
            <a href="https://github.com/dennywright/sfshipbuilder">repo on Github</a> to fork or
            raise issues
          </li>
          <!-- <li>
            Artwork by <a href="https://douglasshuler.com/">Douglas Shuler</a> (used with
            permission)
          </li> -->
          <li>Icons by the <a href="https://thenounproject.com/">Noun Project</a>:</li>
          <ul>
            <li>
              <svg class="icon"><use xlink:href="#icon-close" /></svg>
              created by <a href="https://thenounproject.com/gurupurnima4/">Guru</a>
            </li>
            <li>
              <svg class="icon"><use xlink:href="#icon-power" /></svg>,
              <svg class="icon"><use xlink:href="#icon-trash" /></svg>,
              <svg class="icon"><use xlink:href="#icon-up" /></svg> and
              <svg class="icon"><use xlink:href="#icon-down" /></svg>
              created by <a href="https://thenounproject.com/ayasofya/">Aya Sofya</a>
            </li>
            <li>
              <svg class="icon"><use xlink:href="#icon-menu" /></svg>
              created by <a href="https://thenounproject.com/agniakash40/">Agni</a>
            </li>
            <li>
              <svg class="icon"><use xlink:href="#icon-build" /></svg>
              created by <a href="https://thenounproject.com/creativestall/">Creative Stall</a>
            </li>
            <li>
              <svg class="icon"><use xlink:href="#icon-plus" /></svg>
              created by <a href="https://thenounproject.com/bunkgensara/">Bismillah</a>
            </li>
            <li>
              <svg class="icon"><use xlink:href="#icon-duplicate" /></svg>
              created by <a href="https://thenounproject.com/tyagineha.2112/">Neha Tyagi</a>
            </li>
          </ul>
        </ul>
      </footer>
    </div>
    <!-- main -->
  </div>
  <!-- #app wrapper -->
</template>
